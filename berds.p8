pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
-- berds
-- by primarter

width = 128
height = 128

function _init()
 p1 = {time=0, x=16,  y=56, anim=1, flip=false, disp=true, zone_t=0}
 p2 = {time=0, x=112, y=56, anim=4, flip=false}
 pause = false
 general_time = 0
 game_st = 4
end

function _paused()
 pause = true
end

function _update()
 general_time += 1
 pause = false

 -- player 1 move
 if (btn(0, 1)) then
  p1.x -= 3
  p1.flip = true
 end
 if (btn(1, 1)) then
  p1.x += 3
  p1.flip = false
 end
 if (btn(3, 1)) then
  p1.y += 3
 end
 if (btn(2, 1)) then
  p1.y -= 3
 end

 -- player 2 move
 if (btn(0, 0) and not point_col(p2.x - 2, p2.y) and not point_col(p2.x - 2, p2.y + 7)) then
  p2.x -= 3
  p2.flip = false
 end
 if (btn(1, 0) and not point_col(p2.x + 10, p2.y) and not point_col(p2.x + 10, p2.y + 7)) then
  p2.x += 3
  p2.flip = true
 end
 if (btn(3, 0) and not point_col(p2.x, p2.y + 10) and not point_col(p2.x + 7, p2.y + 10)) then
  p2.y += 3
 end
 if (btn(2, 0) and not point_col(p2.x, p2.y - 1) and not point_col(p2.x + 7, p2.y - 2)) then
  p2.y -= 3
 end

 -- players animations
 p1.time += 1
 p2.time += 1
 if (p2.time % 7 == 0) then
  p2.anim = (p2.anim == 4) and 5 or 4
  p2.time = 0
 end
 if (p1.time % 5 == 0) then
  p1.anim = (p1.anim == 1) and 2 or 1
  p1.time = 0
 end

 -- collisions
 if (collide()) then
  game_st = 1
 end
 p1.x, p1.y = side_collision(p1.x, p1.y)
 p2.x, p2.y = side_collision(p2.x, p2.y)
 p1.disp = check_disp(p1.x, p1.y)
 check_zone()

 -- start
 if (game_st == 4 and btn(4, 1)) then
  game_st = 3
 end

 -- restart
 if (game_st == 1 and btn(4, 1)) then
  game_st = 2
 end
end

function _draw()
 if (pause == false) then
  cls()

  if (game_st == 4) then
   my_menu()
   return
  end
  if (game_st == 3) then
   dr_restart()
  else
   map(0, 0, 0, 0, 16, 16, 0)
  end
  if (game_st == 0) then
   spr(p2.anim, p2.x, p2.y, 1, 1, p2.flip, false)
   if (p1.disp == true) then
    spr(p1.anim, p1.x, p1.y, 1, 1, p1.flip, false)
   end
  elseif (game_st == 1) then
   print('player 1 died', 36, 48, 8)
   print('press tab to restart', 24, 64, 8)
  else
   game_st = 3
   _init()
  end
 end
end
-->8
function collide()
 if (p2.y >= p1.y and p2.y <= p1.y + 8 and p2.x >= p1.x and p2.x <= p1.x + 8) then
   return true
 end
 if (p2.y + 8 >= p1.y and p2.y + 8 <= p1.y + 8 and p2.x >= p1.x and p2.x <= p1.x + 8) then
  return true
 end
 if (p2.y >= p1.y and p2.y <= p1.y + 8 and p2.x + 8 >= p1.x and p2.x + 8 <= p1.x + 8) then
   return true
 end
 if (p2.y + 8 >= p1.y and p2.y + 8 <= p1.y + 8 and p2.x + 8 >= p1.x and p2.x + 8 <= p1.x + 8) then
   return true
 end
 return false
end

function side_collision(sp_x, sp_y)
 test = false
 if (sp_x <= 0) then
  sp_x = 0
  test = true
 end
 if (sp_y <= 0) then
  sp_y = 0
  test = true
 end
 if (sp_x + 8 >= width) then
  sp_x = 120
  test = true
 end
 if (sp_y + 8 >= height) then
  sp_y = 120
  test = true
 end
 return sp_x, sp_y, test
end

function check_disp(x, y)
 if (fget(mget((x + 0) / 8, (y + 0) / 8), 2) == true) and
    (fget(mget((x + 7) / 8, (y + 7) / 8), 2) == true) and
    (fget(mget((x + 7) / 8, (y + 0) / 8), 2) == true) and
    (fget(mget((x + 0) / 8, (y + 7) / 8), 2) == true) then
  return false
 end
 return true
end

function check_zone()
 if (p1.disp == false) then
  p1.zone_t += 1
 else
  p1.zone_t = 0
 end
 if (p1.zone_t >= 75) then
  game_st = 1
 end
end

function point_col(x, y)
 if (fget(mget(x / 8, y / 8), 2) == true) then
  return true
 end
 return false
end

-->8
function my_menu()
 cls()
  
 for i=1,11 do
  for j0=0,7 do
  j = 7-j0
  col = 7+j
  t1 = general_time + i*4 - j*2
  x = cos(t0)*5
  y = 38 + j + cos(t1/50)*5
  pal(7,col)
  spr(18+i, 8+i*8 + x, y)
  end
 end

  print("this is berds!",
    37, 70, 14) --8+(t/4)%8)
    print("press tab to play",
    30, 80, 12) --8+(t/4)%8)

  spr(0, 48, 90)
  spr(3, 72, 90)
end

function dr_restart()
 cls()
 map(0, 0, 0, 0, 16, 16, 0)
 print('ready?', 52, 56, 8)
 sleep(1.5)
 cls()
 map(0, 0, 0, 0, 16, 16, 0)
 print('chase!', 52, 56, 8)
 sleep(0.75)
 game_st = 0
end

function sleep(n) 
 for i=1, n*30 do
  flip()
 end
end
__gfx__
000000000000000000000000000000000000000000000000ccccccccccccccccccccc77ccccccccceeeeeeeeeeeeeeeee22222222222222e2222222222222222
0bbbbbb000a0bbb00000bbb0022222200222288002222220ccccccccc777cccccc77777ccccccccce22222222222222ee22222222222222e2222222222222222
073333700a9ab37000bbb370021111202111811821111112ccccccccc777777c77777777cc7777cce22222222222222ee22222222222222e2222222222222222
063333600a99a3600b33336002eeee20ee181118ee118812cccccccc7777777777777777cc77777ce22222222222222ee22222222222222e2222222222222222
ab3bb3bab3aa333bb3aa333b828888288818118288181182cccccccc7777776776666667c7777767e22222222222222ee22222222222222e2222222222222222
9a3883a90bb333b80a99a3b816766761676e88e267681118ccccccccc77666677777777777666667e22222222222222ee22222222222222e2222222222222222
aabbbbaa000bbbb00a9abbb08162261826eeeee226ee8118cccccccccc777777cccccc7c77777777e22222222222222ee22222222222222e2222222222222222
a000000a0000000000a00000880000880222222002222880cccccccccccccccccccccccccccccc7ce22222222222222eeeeeeeeeeeeeeeee22222222eeeeeeee
eeeeeeeee22222222222222e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22222222e22222222222222e07777700077777700777770007777000077777700000000007777770077007700077770007777770077777700000000000000000
22222222e22222222222222e07700070077000000770007007700770077000000000000007700000077007700770077007700000077000000000000000000000
22222222e22222222222222e07700070077000000777770007700770077000000000000007700000077007700770077007700000077000000000000000000000
22222222e22222222222222e07777700077770000770700007700770077777700000000007700000077777700777777007777770077770000000000000000000
22222222e22222222222222e07700070077000000770070007700770000007700000000007700000077007700770077000000770077000000000000000000000
22222222e22222222222222e07777700077777700770007007777770077777700000000007777770077007700770077007777770077777700000000000000000
22222222e22222222222222e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0001010002020000000004040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0606060706060606060606060606060600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
060606060607060906060a10100b060700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06080606060606060706110e0e12060600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
060606070606080606060c0f0f0d070600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0609060606060609060606060706060600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0606060906070606060906060606060600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0607060606060806060606060906080600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0606060606060607060608060606060600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0706060706060806060606060608060600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0606060606060606090606060706060600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0806060806070606060607060606070600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0606060606060608060906060608060600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0607060606090606060606070606060600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
060a10100b060706060606060606070600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06110e0e12060606070608060606060600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
070c0f0f0d060607060606080607060700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0606090606060906080606060906060600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0906060609060606060806060606060700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
0010000000472004620c3400c34318470004313102500415000702905500375183750c3000c3751f4730c375053720536211540114330c37524555247120c3730a470163521d07522375164120a211220252e315
01100000183732440518433394033c65539403185432b543184733940318433394033c655306053940339403184733940318423394033c655394031845321433184733940318473394033c655394033940339403
01100000247552775729755277552475527755297512775524755277552b755277552475527757297552775720755247572775524757207552475227755247522275526757297552675722752267522975526751
01100000001750c055003550c055001750c055003550c05500175180650c06518065001750c065003650c065051751106505365110650c17518075003650c0650a145160750a34516075111451d075113451d075
011000001b5771f55722537265171b5361f52622515265121b7771f76722757267471b7461f7362271522712185771b5571d53722517187361b7261d735227122454527537295252e5171d73514745227452e745
01100000275422754227542275422e5412e5452b7412b5422b5452b54224544245422754229541295422954224742277422e7422b7422b5422b5472954227542295422b742307422e5422e7472b547305462e742
0110000030555307652e5752b755295622e7722b752277622707227561297522b072295472774224042275421b4421b5451b5421b4421d542295471d442295422444624546245472444727546275462944729547
0110000000200002000020000200002000020000200002000020000200002000020000200002000020000200110171d117110171d227131211f227130371f2370f0411b1470f2471b35716051221571626722367
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002e775000002e1752e075000002e1752e77500000
__music__
00 00044208
00 00044108
00 00010304
00 00010304
01 00010203
00 00010203
00 00010305
00 00010306
00 00010305
00 00010306
00 00010245
02 00010243

